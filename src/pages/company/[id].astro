---
import Layout from '../../layouts/Layout.astro';
import companiesData from '../../data/companies.json';

export function getStaticPaths() {
  return companiesData.companies.map(company => ({
    params: { id: company.id },
    props: { company }
  }));
}

const { company } = Astro.props;

// Format currency
function formatValuation(value: number | null): string {
  if (!value) return 'N/A';
  if (value >= 1e12) return `$${(value / 1e12).toFixed(2)}T`;
  if (value >= 1e9) return `$${(value / 1e9).toFixed(2)}B`;
  if (value >= 1e6) return `$${(value / 1e6).toFixed(0)}M`;
  return `$${value.toLocaleString()}`;
}

// Get initials for logo fallback
function getInitials(name: string): string {
  return name.split(' ').map(w => w[0]).join('').slice(0, 2).toUpperCase();
}

// Country flag emoji
const countryFlags: Record<string, string> = {
  'USA': 'ðŸ‡ºðŸ‡¸',
  'China': 'ðŸ‡¨ðŸ‡³',
  'South Korea': 'ðŸ‡°ðŸ‡·',
  'Japan': 'ðŸ‡¯ðŸ‡µ',
  'Germany': 'ðŸ‡©ðŸ‡ª',
  'Norway': 'ðŸ‡³ðŸ‡´',
  'Canada': 'ðŸ‡¨ðŸ‡¦'
};

const sections = [
  { id: 'overview', title: 'Company Overview' },
  { id: 'valuation', title: 'Valuation History' },
  { id: 'humanoids', title: 'Humanoids' },
  { id: 'story', title: 'Company Story' },
  { id: 'exit', title: 'Exit Strategy' },
  { id: 'risks', title: 'Key Risks' }
];

// Companies with dark/black logos that need light background in dark mode
const darkLogos = ['apptronik', 'hyundai', 'honda', 'toyota', 'xpeng', 'agility-robotics', '1x-technologies', 'neura-robotics'];

// Companies with white/light logos that need to be inverted in light mode
const lightLogos: string[] = [];

// Companies with SVG logos instead of ICO
const svgLogos = ['neura-robotics'];
function getLogoPath(companyId: string): string {
  return `/logos/${companyId}.${svgLogos.includes(companyId) ? 'svg' : 'ico'}`;
}

// Prepare valuation history data for chart
const valuationHistory = company.valuationHistory || [];

// SEO metadata
const siteUrl = "https://robotico-portal.netlify.app";
const pageUrl = `${siteUrl}/company/${company.id}`;
const pageTitle = `${company.name} - Humanoid Robotics Company | Market Cap & Valuation`;
const pageDescription = `${company.name} (${company.flagshipRobot}) - ${company.description.slice(0, 150)}... View market cap, valuation history, and company details.`;
const pageKeywords = `${company.name}, ${company.flagshipRobot}, humanoid robot, ${company.country} robotics, ${company.type === 'public' ? company.ticker + ' stock' : 'private company'}, robotics valuation`;

// Structured data for the company (Organization schema)
const companyStructuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": `${pageUrl}#organization`,
      "name": company.name,
      "url": company.website,
      "logo": `${siteUrl}${getLogoPath(company.id)}`,
      "description": company.description,
      "foundingDate": company.founded.toString(),
      "founder": {
        "@type": "Person",
        "name": company.ceo
      },
      "address": {
        "@type": "PostalAddress",
        "addressLocality": company.headquarters
      },
      "areaServed": "Worldwide",
      "sameAs": [
        company.twitter,
        company.linkedin,
        company.website
      ].filter(Boolean)
    },
    {
      "@type": "Product",
      "@id": `${pageUrl}#product`,
      "name": company.flagshipRobot,
      "description": `Flagship humanoid robot by ${company.name}`,
      "brand": {
        "@type": "Brand",
        "name": company.name
      },
      "category": "Humanoid Robot",
      "image": `${siteUrl}/robots/${company.id}.webp`,
      "manufacturer": {
        "@id": `${pageUrl}#organization`
      }
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": siteUrl
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Companies",
          "item": siteUrl
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": company.name,
          "item": pageUrl
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": `What is ${company.name}'s flagship humanoid robot?`,
          "acceptedAnswer": {
            "@type": "Answer",
            "text": `${company.name}'s flagship humanoid robot is ${company.flagshipRobot}, designed for industrial and commercial applications.`
          }
        },
        {
          "@type": "Question",
          "name": `What is ${company.name}'s current valuation?`,
          "acceptedAnswer": {
            "@type": "Answer",
            "text": company.type === 'public'
              ? `${company.name} is a publicly traded company on ${company.exchange} under ticker ${company.ticker}. Market cap fluctuates with stock price.`
              : `${company.name} is currently valued at approximately ${formatValuation(company.valuationManual)} based on their latest funding round.`
          }
        },
        {
          "@type": "Question",
          "name": `When was ${company.name} founded?`,
          "acceptedAnswer": {
            "@type": "Answer",
            "text": `${company.name} was founded in ${company.founded} and is headquartered in ${company.headquarters}.`
          }
        }
      ]
    }
  ]
};
---

<Layout
  title={pageTitle}
  description={pageDescription}
  canonicalUrl={pageUrl}
  ogType="article"
  keywords={pageKeywords}
  structuredData={companyStructuredData}
>
  <div class="company-page">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a href="/">Home</a>
      <span>/</span>
      <a href="/">Companies</a>
      <span>/</span>
      <span class="current">{company.name}</span>
    </div>

    <!-- Hero Section -->
    <section class="company-hero">
      <div class="hero-content">
        <div class="hero-logo">
          <img
            src={getLogoPath(company.id)}
            alt={`${company.name} logo`}
            class={`company-logo-large${darkLogos.includes(company.id) ? ' dark-logo' : ''}${lightLogos.includes(company.id) ? ' light-logo' : ''}`}
            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
          />
          <div class="company-logo-fallback-large" style="display:none;">{getInitials(company.name)}</div>
        </div>
        <div class="hero-info">
          <h1>{company.name}</h1>
          <a href={company.website} target="_blank" rel="noopener" class="website-link">
            {company.website.replace('https://', '')}
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
              <polyline points="15 3 21 3 21 9"/>
              <line x1="10" y1="14" x2="21" y2="3"/>
            </svg>
          </a>
          <p class="company-description">{company.description}</p>
        </div>
        <div class="hero-meta">
          <div class="meta-item">
            <span class="meta-label">CEO</span>
            <span class="meta-value">{company.ceo}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Headquarters</span>
            <span class="meta-value">{company.headquarters}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Valuation</span>
            <span class="meta-value valuation-value" data-id={company.id} data-manual={company.valuationManual}>
              {company.type === 'public' ? 'Loading...' : formatValuation(company.valuationManual)}
            </span>
          </div>
          <div class="social-links">
            {company.twitter && (
              <a href={company.twitter} target="_blank" rel="noopener" aria-label="Twitter">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              </a>
            )}
            {company.linkedin && (
              <a href={company.linkedin} target="_blank" rel="noopener" aria-label="LinkedIn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
            )}
          </div>

        </div>
      </div>
    </section>

    <div class="company-content">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="toc">
          <h3>Summary</h3>
          <ol>
            {sections.map((section, index) => (
              <li>
                <a href={`#${section.id}`}>
                  <span class="toc-number">{String(index + 1).padStart(2, '0')}</span>
                  {section.title}
                </a>
              </li>
            ))}
          </ol>
        </nav>
        <div class="cta-box">
          <h4>Get Your Company Listed</h4>
          <a href="mailto:hello@robotico.com" class="cta-button">Add your company</a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Company Overview -->
        <section id="overview" class="content-section">
          <h2>Company Overview</h2>
          <p>{company.description}</p>

          <h3>The {company.flagshipRobot}</h3>
          <p>{company.name}'s flagship humanoid robot is {company.flagshipRobot}, designed for industrial and commercial applications.</p>

          <ul class="feature-list">
            <li>
              <strong>Founded:</strong> {company.founded} in {company.country}
            </li>
            <li>
              <strong>Type:</strong> {company.type === 'public' ? `Public (${company.exchange}: ${company.ticker})` : 'Private'}
            </li>
            <li>
              <strong>Headquarters:</strong> {company.headquarters}
            </li>
          </ul>

          <h3>Current Valuation</h3>
          <p>
            {company.type === 'public'
              ? `As a publicly traded company on ${company.exchange}, ${company.name}'s market capitalization fluctuates with stock price.`
              : `${company.name} is currently valued at ${formatValuation(company.valuationManual)} based on their latest funding round.`
            }
          </p>
        </section>

        <!-- Valuation History -->
        <section id="valuation" class="content-section">
          <h2>Valuation History</h2>
          <p>
            {company.type === 'public'
              ? `Track ${company.name}'s market capitalization over time as a publicly traded company.`
              : `Follow ${company.name}'s valuation growth through its funding rounds.`
            }
          </p>
          <div class="chart-container">
            <canvas id="valuationChart"></canvas>
          </div>
          {valuationHistory.length > 0 && valuationHistory.some((h: any) => h.event) && (
            <div class="funding-timeline">
              <h3>Funding Rounds</h3>
              <div class="timeline">
                {valuationHistory.filter((h: any) => h.event).map((h: any) => (
                  <div class="timeline-item">
                    <span class="timeline-date">{h.date}</span>
                    <span class="timeline-event">{h.event}</span>
                    <span class="timeline-value">{formatValuation(h.value)}</span>
                  </div>
                ))}
              </div>
            </div>
          )}
        </section>

        <!-- Humanoids -->
        <section id="humanoids" class="content-section">
          <h2>Humanoids</h2>
          <div class="robot-grid">
            {company.robots && company.robots.length > 0 ? (
              company.robots.map((robot: any) => (
                <a href={`/robot/${robot.id}`} class="robot-card robot-card-link">
                  <div class="robot-image">
                    <img
                      src={robot.image || `/robots/${company.id}.webp`}
                      alt={`${robot.name} robot`}
                      class="robot-img"
                      onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                    />
                    <div class="robot-placeholder" style="display:none;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="3" y="11" width="18" height="10" rx="2"/>
                        <circle cx="12" cy="5" r="4"/>
                        <path d="M7 11V7"/>
                        <path d="M17 11V7"/>
                      </svg>
                    </div>
                  </div>
                  <div class="robot-info">
                    <div class="robot-header">
                      <h4>{robot.name}</h4>
                      <span class={`robot-status ${robot.status === 'commercial' ? 'status-commercial' : 'status-prototype'}`}>
                        {robot.status === 'commercial' ? 'Commercial' : 'Prototype'}
                      </span>
                    </div>
                    <p>{robot.tagline ? robot.tagline.slice(0, 80) + '...' : `Humanoid robot by ${company.name}`}</p>
                    <span class="view-details">
                      View specifications
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                      </svg>
                    </span>
                  </div>
                </a>
              ))
            ) : (
              <div class="robot-card">
                <div class="robot-image">
                  <img
                    src={`/robots/${company.id}.webp`}
                    alt={`${company.flagshipRobot} robot`}
                    class="robot-img"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                  />
                  <div class="robot-placeholder" style="display:none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <rect x="3" y="11" width="18" height="10" rx="2"/>
                      <circle cx="12" cy="5" r="4"/>
                      <path d="M7 11V7"/>
                      <path d="M17 11V7"/>
                    </svg>
                  </div>
                </div>
                <div class="robot-info">
                  <h4>{company.flagshipRobot}</h4>
                  <p>Flagship humanoid robot by {company.name}</p>
                </div>
              </div>
            )}
          </div>
        </section>

        <!-- Company Story -->
        <section id="story" class="content-section">
          <h2>Company Story</h2>

          <h3>A Huge Market</h3>
          <p>The humanoid robotics market represents one of the most transformative opportunities of the next decade. {company.name}, founded in {company.founded}, is positioned to address the global labor crisis while revolutionizing every major industry.</p>

          <h3>A Clear Leader</h3>
          <p>{company.name} is among the leading companies in humanoid robots globally. The company is:</p>
          <ul class="feature-list">
            <li><strong>Well funded:</strong> Backed by significant investment to accelerate R&D and commercialization.</li>
            <li><strong>Strong differentiation:</strong> {company.flagshipRobot} offers unique capabilities in its target markets.</li>
            <li><strong>Competitive:</strong> Positioned to capture market share in the rapidly growing humanoid robotics sector.</li>
          </ul>
        </section>

        <!-- Exit Strategy -->
        <section id="exit" class="content-section">
          <h2>Exit Strategy</h2>
          {company.type === 'public' ? (
            <p>{company.name} is already a publicly traded company on {company.exchange} under the ticker {company.ticker}.</p>
          ) : (
            <>
              <h3>1. Exit Through IPO</h3>
              <p>As the market matures, there will be strong demand for humanoid robotics companies in the public markets. {company.name} is among the well-capitalized players in the space.</p>

              <h3>2. Strategic Acquisition</h3>
              <p>{company.name} could become an acquisition target for tech giants or automotive companies who urgently need automation solutions for logistics and manufacturing.</p>
            </>
          )}
        </section>

        <!-- Key Risks -->
        <section id="risks" class="content-section">
          <h2>Key Risks & Considerations</h2>
          <p>While humanoid robotics presents extraordinary potential, there are material risks:</p>
          <ul class="feature-list">
            <li><strong>Execution risks:</strong> Successfully scaling complex hardware and AI systems remains a massive challenge.</li>
            <li><strong>Competition:</strong> Multiple well-funded companies are competing in the same space.</li>
            <li><strong>Regulatory hurdles:</strong> Public resistance to job displacement and safety incidents could delay mass deployment.</li>
          </ul>
        </section>
      </main>
    </div>
  </div>
</Layout>

<style>
  .company-page {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
  }

  /* Breadcrumb */
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) 0;
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  .breadcrumb a {
    color: var(--color-text-muted);
  }

  .breadcrumb a:hover {
    color: var(--color-primary);
  }

  .breadcrumb .current {
    color: var(--color-text);
  }

  /* Hero Section */
  .company-hero {
    padding: var(--spacing-xl) 0;
    border-bottom: 1px solid var(--color-border);
  }

  .hero-content {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: var(--spacing-xl);
    align-items: start;
  }

  .hero-logo {
    flex-shrink: 0;
  }

  .company-logo-large {
    width: 80px;
    height: 80px;
    border-radius: var(--radius-md);
    background: var(--color-bg-secondary);
    object-fit: contain;
    border: 1px solid var(--color-border);
  }

  /* Dark logos need light background in dark mode */
  :global([data-theme="dark"]) .company-logo-large.dark-logo {
    background: #ffffff;
    padding: 8px;
  }

  /* Light/white logos need to be inverted in light mode */
  :global([data-theme="light"]) .company-logo-large.light-logo,
  :global(:root:not([data-theme="dark"])) .company-logo-large.light-logo {
    filter: invert(1);
  }

  .company-logo-fallback-large {
    width: 80px;
    height: 80px;
    border-radius: var(--radius-md);
    background: var(--color-text);
    color: var(--color-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
  }

  .hero-info h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: var(--spacing-xs);
  }

  .website-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    color: var(--color-primary);
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
  }

  .website-link:hover {
    color: var(--color-accent);
  }

  .company-description {
    color: var(--color-text-secondary);
    line-height: 1.6;
    max-width: 600px;
  }

  .hero-meta {
    text-align: right;
  }

  .meta-item {
    margin-bottom: var(--spacing-sm);
  }

  .meta-label {
    display: block;
    font-size: 0.75rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .meta-value {
    font-weight: 600;
    color: var(--color-text);
  }

  .valuation-value {
    font-family: var(--font-mono);
    font-size: 1.25rem;
  }

  .social-links {
    display: flex;
    gap: var(--spacing-sm);
    justify-content: flex-end;
    margin-top: var(--spacing-md);
  }

  .social-links a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    background: var(--color-bg-secondary);
    color: var(--color-text-secondary);
    transition: all var(--transition-fast);
    border: 1px solid var(--color-border);
  }

  .social-links a:hover {
    background: transparent;
    color: var(--color-primary);
    border-color: var(--color-primary);
  }

  /* Content Layout */
  .company-content {
    display: grid;
    grid-template-columns: 240px 1fr;
    gap: var(--spacing-2xl);
    padding: var(--spacing-xl) 0;
  }

  /* Sidebar */
  .sidebar {
    position: sticky;
    top: 100px;
    height: fit-content;
  }

  .toc h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--spacing-md);
  }

  .toc ol {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .toc li {
    margin-bottom: var(--spacing-sm);
  }

  .toc a {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-xs) 0;
    color: var(--color-text-secondary);
    font-size: 0.875rem;
    transition: color var(--transition-fast);
  }

  .toc a:hover {
    color: var(--color-text);
  }

  .toc-number {
    color: var(--color-text-muted);
    font-family: var(--font-mono);
    font-size: 0.75rem;
  }

  .cta-box {
    margin-top: var(--spacing-xl);
    padding: var(--spacing-lg);
    background: var(--color-bg-secondary);
    border-radius: 0;
    border: 1px solid var(--color-border);
  }

  .cta-box h4 {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--spacing-sm);
    color: var(--color-text);
  }

  .cta-button {
    display: inline-block;
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--color-primary);
    color: #010101;
    font-weight: 600;
    font-size: 0.875rem;
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-primary);
    transition: all var(--transition-fast);
  }

  .cta-button:hover {
    background: #19b010;
    border-color: #19b010;
    color: #010101;
  }

  /* Main Content */
  .main-content {
    max-width: 800px;
  }

  .content-section {
    margin-bottom: var(--spacing-2xl);
    padding-bottom: var(--spacing-2xl);
    border-bottom: 1px solid var(--color-border);
  }

  .content-section:last-child {
    border-bottom: none;
  }

  .content-section h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: var(--spacing-lg);
    color: var(--color-text);
    letter-spacing: -0.02em;
  }

  .content-section h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
    color: var(--color-text);
  }

  .content-section p {
    color: var(--color-text-secondary);
    line-height: 1.7;
    margin-bottom: var(--spacing-md);
  }

  .feature-list {
    list-style: none;
    padding: 0;
    margin: var(--spacing-md) 0;
  }

  .feature-list li {
    position: relative;
    padding-left: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
    color: var(--color-text-secondary);
    line-height: 1.6;
  }

  .feature-list li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.5em;
    width: 6px;
    height: 6px;
    background: var(--color-accent);
    border-radius: 50%;
  }

  .feature-list li strong {
    color: var(--color-text);
  }

  /* Robot Grid */
  .robot-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--spacing-lg);
    margin-top: var(--spacing-lg);
  }

  .robot-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 0;
    overflow: hidden;
    transition: box-shadow var(--transition-fast);
  }

  .robot-card:hover {
    box-shadow: var(--shadow-md);
  }

  .robot-image {
    aspect-ratio: 1;
    background: var(--color-bg-secondary);
    overflow: hidden;
  }

  .robot-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .robot-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-muted);
  }

  .robot-info {
    padding: var(--spacing-md);
  }

  .robot-info h4 {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
    color: var(--color-text);
  }

  .robot-info p {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    margin: 0;
  }

  .robot-card-link {
    cursor: pointer;
    text-decoration: none;
    display: block;
  }

  .robot-card-link:hover {
    border-color: var(--color-primary);
  }

  .robot-card-link:hover .view-details {
    color: var(--color-primary);
  }

  .robot-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-xs);
  }

  .robot-header h4 {
    margin: 0;
  }

  .robot-status {
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    padding: 2px 6px;
    border-radius: var(--radius-xs);
  }

  .robot-status.status-commercial {
    background: rgba(30, 214, 18, 0.15);
    color: var(--color-primary);
  }

  .robot-status.status-prototype {
    background: rgba(245, 158, 11, 0.15);
    color: #f59e0b;
  }

  .view-details {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--color-text-secondary);
    margin-top: var(--spacing-sm);
    transition: color var(--transition-fast);
  }

  /* Responsive */
  @media (max-width: 992px) {
    .hero-content {
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }

    .hero-meta {
      text-align: left;
    }

    .social-links {
      justify-content: flex-start;
    }

    .company-content {
      grid-template-columns: 1fr;
    }

    .sidebar {
      position: static;
      display: flex;
      gap: var(--spacing-xl);
    }

    .toc {
      flex: 1;
    }

    .cta-box {
      margin-top: 0;
      flex: 1;
    }
  }

  @media (max-width: 768px) {
    .company-page {
      padding: 0 var(--spacing-md);
    }

    .breadcrumb {
      font-size: 0.8125rem;
      padding: var(--spacing-sm) 0;
      flex-wrap: wrap;
    }

    .company-hero {
      padding: var(--spacing-lg) 0;
    }

    .hero-content {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .hero-logo {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .company-logo-large,
    .company-logo-fallback-large {
      width: 56px;
      height: 56px;
    }

    .company-logo-fallback-large {
      font-size: 1.125rem;
    }

    .hero-info h1 {
      font-size: 1.5rem;
    }

    .company-description {
      font-size: 0.9375rem;
    }

    .hero-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-sm);
    }

    .social-links {
      grid-column: 1 / -1;
    }

    .valuation-value {
      font-size: 1rem;
    }

    .sidebar {
      flex-direction: column;
      gap: var(--spacing-lg);
    }

    .toc ol {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-xs);
    }

    .toc a {
      font-size: 0.8125rem;
    }

    .content-section h2 {
      font-size: 1.25rem;
    }

    .content-section h3 {
      font-size: 1rem;
    }

    .content-section p {
      font-size: 0.9375rem;
    }

    .chart-container {
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
    }

    .robot-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .hero-meta {
      grid-template-columns: 1fr;
    }

    .toc ol {
      grid-template-columns: 1fr;
    }

    .timeline-item {
      grid-template-columns: 1fr;
      gap: var(--spacing-xs);
    }
  }

  /* Chart Container */
  .chart-container {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 0;
    padding: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
  }

  /* Funding Timeline */
  .funding-timeline {
    margin-top: var(--spacing-xl);
  }

  .funding-timeline h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--color-text);
  }

  .timeline {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .timeline-item {
    display: grid;
    grid-template-columns: 100px 1fr auto;
    gap: var(--spacing-md);
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--color-bg-secondary);
    border-radius: 0;
    border-left: 3px solid var(--color-accent);
    align-items: center;
  }

  .timeline-date {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  .timeline-event {
    font-weight: 500;
    color: var(--color-text);
  }

  .timeline-value {
    font-family: var(--font-mono);
    font-weight: 600;
    color: var(--color-accent);
  }

  @media (max-width: 640px) {
    .timeline-item {
      grid-template-columns: 1fr;
      gap: var(--spacing-xs);
    }
  }
</style>

<script define:vars={{ valuationHistory: JSON.stringify(valuationHistory), companyName: company.name }}>
  // Format currency helper
  function formatValuation(value) {
    if (value >= 1e12) return `$${(value / 1e12).toFixed(2)}T`;
    if (value >= 1e9) return `$${(value / 1e9).toFixed(2)}B`;
    if (value >= 1e6) return `$${(value / 1e6).toFixed(0)}M`;
    return `$${value.toLocaleString()}`;
  }

  // Fetch real stock prices
  async function updateValuation() {
    const valuationEl = document.querySelector('.valuation-value');
    if (!valuationEl) return;

    const companyId = valuationEl.getAttribute('data-id');
    const manualVal = valuationEl.getAttribute('data-manual');

    if (manualVal && manualVal !== 'null') {
      return; // Already has manual valuation
    }

    try {
      const response = await fetch('/api/stock-prices');
      const result = await response.json();

      if (result.success && result.data && result.data[companyId]) {
        const marketCap = result.data[companyId].marketCap;
        valuationEl.textContent = formatValuation(marketCap);
      }
    } catch (error) {
      console.error('Failed to fetch valuation:', error);
    }
  }

  // Initialize valuation chart
  function initChart() {
    const canvas = document.getElementById('valuationChart');
    if (!canvas || typeof Chart === 'undefined') return;

    const history = JSON.parse(valuationHistory);
    if (!history || history.length === 0) return;

    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const textColor = isDark ? '#a1a1aa' : '#71717a';
    const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
    const accentColor = '#1ED612';
    const accentColorLight = isDark ? 'rgba(30, 214, 18, 0.2)' : 'rgba(30, 214, 18, 0.1)';

    const labels = history.map(h => h.date);
    const values = history.map(h => h.value);

    const ctx = canvas.getContext('2d');

    // Destroy existing chart if any
    if (window.valuationChartInstance) {
      window.valuationChartInstance.destroy();
    }

    window.valuationChartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Valuation',
          data: values,
          borderColor: accentColor,
          backgroundColor: accentColorLight,
          fill: true,
          stepped: true,
          pointRadius: 6,
          pointHoverRadius: 8,
          pointBackgroundColor: accentColor,
          pointBorderColor: isDark ? '#18181b' : '#ffffff',
          pointBorderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        aspectRatio: 2.5,
        interaction: {
          intersect: false,
          mode: 'index'
        },
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: isDark ? '#27272a' : '#ffffff',
            titleColor: isDark ? '#fafafa' : '#010101',
            bodyColor: isDark ? '#a1a1aa' : '#71717a',
            borderColor: isDark ? '#3f3f46' : '#e4e4e7',
            borderWidth: 1,
            padding: 12,
            displayColors: false,
            callbacks: {
              label: function(context) {
                return formatValuation(context.parsed.y);
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              color: gridColor
            },
            ticks: {
              color: textColor,
              font: {
                family: "'TWK Everett', 'Space Grotesk', sans-serif",
                size: 11
              }
            }
          },
          y: {
            grid: {
              color: gridColor
            },
            ticks: {
              color: textColor,
              font: {
                family: "'TWK Everett', 'Space Grotesk', sans-serif",
                size: 11
              },
              callback: function(value) {
                return formatValuation(value);
              }
            }
          }
        }
      }
    });
  }

  // Listen for theme changes
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'data-theme') {
        initChart();
      }
    });
  });
  observer.observe(document.documentElement, { attributes: true });

  document.addEventListener('DOMContentLoaded', function() {
    updateValuation();
    initChart();
  });
</script>

---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const { Content } = await render(article);

// Format date
function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}

// SEO metadata
const siteUrl = "https://xmaquina-marketcap.netlify.app";
const pageUrl = `${siteUrl}/news/${article.slug}`;
const pageTitle = `${article.data.title} | XMAQUINA News`;
const pageDescription = article.data.description;
const pageKeywords = `humanoid robots, robotics news, ${article.data.companies?.join(', ') || 'robotics industry'}`;
const ogImage = article.data.image ? `${siteUrl}${article.data.image}` : `${siteUrl}/og-image.svg`;

// Structured data for article
const structuredData = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": article.data.title,
  "description": article.data.description,
  "image": ogImage,
  "datePublished": article.data.pubDate.toISOString(),
  "dateModified": article.data.pubDate.toISOString(),
  "author": {
    "@type": "Person",
    "name": article.data.author
  },
  "publisher": {
    "@type": "Organization",
    "name": "XMAQUINA",
    "url": "https://xmaquina.io",
    "logo": {
      "@type": "ImageObject",
      "url": `${siteUrl}/xmaquina-logo.svg`
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": pageUrl
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": siteUrl
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "News",
        "item": `${siteUrl}/news`
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": article.data.title,
        "item": pageUrl
      }
    ]
  }
};
---

<Layout
  title={pageTitle}
  description={pageDescription}
  keywords={pageKeywords}
  ogImage={ogImage}
  ogType="article"
  structuredData={structuredData}
>
  <article class="article-page">
    <div class="container">
      <nav class="breadcrumb">
        <a href="/">Home</a>
        <span class="separator">/</span>
        <a href="/news">News</a>
        <span class="separator">/</span>
        <span class="current">{article.data.title}</span>
      </nav>

      <header class="article-header">
        <div class="article-meta">
          <time datetime={article.data.pubDate.toISOString()}>
            {formatDate(article.data.pubDate)}
          </time>
          <span class="author">by {article.data.author}</span>
        </div>
        <h1>{article.data.title}</h1>
        <p class="description">{article.data.description}</p>
        {article.data.companies && article.data.companies.length > 0 && (
          <div class="article-tags">
            {article.data.companies.map((company: string) => (
              <a href={`/company/${company}`} class="tag">{company}</a>
            ))}
          </div>
        )}
      </header>

      {article.data.image && (
        <div class="featured-image">
          <img src={article.data.image} alt={article.data.title} />
        </div>
      )}

      <div class="article-content prose">
        <Content />
      </div>

      <footer class="article-footer">
        <a href="/news" class="back-link">← Back to News</a>
      </footer>
    </div>
  </article>
</Layout>

<style>
  .article-page {
    padding: var(--spacing-xl) 0 var(--spacing-3xl);
  }

  .article-page .container {
    max-width: 800px;
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-lg);
    flex-wrap: wrap;
  }

  .breadcrumb a {
    color: var(--color-text-muted);
    text-decoration: none;
  }

  .breadcrumb a:hover {
    color: var(--color-primary);
  }

  .breadcrumb .separator {
    opacity: 0.5;
  }

  .breadcrumb .current {
    color: var(--color-text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 300px;
  }

  .article-header {
    margin-bottom: var(--spacing-xl);
  }

  .article-meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-md);
  }

  .article-meta .author::before {
    content: '•';
    margin-right: var(--spacing-sm);
  }

  .article-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: var(--spacing-md);
  }

  .article-header .description {
    font-size: 1.25rem;
    color: var(--color-text-muted);
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
  }

  .article-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
  }

  .tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 9999px;
    font-size: 0.875rem;
    color: var(--color-text-muted);
    text-decoration: none;
    text-transform: capitalize;
    transition: all 0.2s ease;
  }

  .tag:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
  }

  .featured-image {
    margin-bottom: var(--spacing-xl);
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--color-surface);
  }

  .featured-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Article prose styles */
  .prose {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-text);
  }

  .prose :global(h2) {
    font-size: 1.75rem;
    font-weight: 600;
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
  }

  .prose :global(h3) {
    font-size: 1.375rem;
    font-weight: 600;
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
  }

  .prose :global(p) {
    margin-bottom: var(--spacing-md);
  }

  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-lg);
  }

  .prose :global(li) {
    margin-bottom: var(--spacing-xs);
  }

  .prose :global(blockquote) {
    margin: var(--spacing-lg) 0;
    padding: var(--spacing-md) var(--spacing-lg);
    border-left: 4px solid var(--color-primary);
    background: var(--color-surface);
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
    font-style: italic;
    color: var(--color-text-muted);
  }

  .prose :global(blockquote p) {
    margin-bottom: 0;
  }

  .prose :global(a) {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose :global(a:hover) {
    text-decoration: none;
  }

  .prose :global(strong) {
    font-weight: 600;
    color: var(--color-text);
  }

  .prose :global(code) {
    background: var(--color-surface);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.9em;
  }

  .prose :global(pre) {
    background: var(--color-surface);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
  }

  .prose :global(pre code) {
    background: none;
    padding: 0;
  }

  .prose :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    margin: var(--spacing-lg) 0;
  }

  .article-footer {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    color: var(--color-text-muted);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .back-link:hover {
    color: var(--color-primary);
  }

  @media (max-width: 768px) {
    .article-header h1 {
      font-size: 1.75rem;
    }

    .article-header .description {
      font-size: 1.125rem;
    }

    .prose {
      font-size: 1rem;
    }

    .prose :global(h2) {
      font-size: 1.5rem;
    }

    .prose :global(h3) {
      font-size: 1.25rem;
    }
  }
</style>
